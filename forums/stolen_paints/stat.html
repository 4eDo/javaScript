<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сводная таблица</title>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: rgba(0,0,0,0.3);
        }
        #th_2 th{
            width: 70px;
        }
        tr:hover {
            background-color: rgba(0,0,0,0.3);
        }
        .color-box {
          display: inline-block;
          width: 50px;
          height: 50px;
          margin-right: 5px;
          vertical-align: middle;
        }
        .red-box {
          background-image: url("img/paint_0_red.png");
        }
        .green-box {
          background-image: url("img/paint_1_green.png");
        }
        .blue-box {
          background-image: url("img/paint_2_blue.png");
        }
        .white-box {
          background-image: url("img/paint_4_white.png");
        }
        .black-box {
          background-image: url("img/paint_3_black.png");;
        }
        .gray-box {
          background-image: url("img/paint_5_gray.png");
        }
        .rainbow-box {
          background-image: url("img/paint_6_rainbow.png");
        }
    </style>
</head>
<body>

<h1>Сводная таблица по пользователям и картинам</h1>
<table>
    <thead>
        <tr>
            <th>Пользователь</th>
            <th colspan="7">Картины</th>
            <th colspan="7">Цвета</th>
            <th>Итого</th>
        </tr>
        <tr id="th_2">
            <th></th>
            <th>Алый дракон</th>
            <th>Зелёный леший</th>
            <th>Сапфировая акула</th>
            <th>Живая тень</th>
            <th>Белоснежный пегас</th>
            <th>Скучающий дементор</th>
            <th>Пьяная вейла</th>
            <th class="color-box red-box" title="Красный пигмент"></th>
            <th class="color-box green-box" title="Зелёный пигмент"></th>
            <th class="color-box blue-box" title="Синий пигмент"></th>
            <th class="color-box black-box" title="Чёрный пигмент"></th>
            <th class="color-box white-box" title="Белый пигмент"></th>
            <th class="color-box gray-box" title="Выцветшая основа"></th>
            <th class="color-box rainbow-box" title="Психоделическая основа"></th>
            <th></th>
        </tr>
    </thead>
    <tbody id="data-body">
        <!-- Здесь будет заполнение данных -->
    </tbody>
</table>

<script>
    const timestamp = new Date().getTime();
    const url = `https://4edo.github.io/javaScript/forums/stolen_paints/found_paints.json?timestamp=${timestamp}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            const users = {};

            data.forEach(item => {
                const user = item.user;
                const picId = item.picId;
                
                // Инициализация пользователя, если он еще не создан
                if (!users[user]) {
                    users[user] = {
                        picSums: Array(8).fill(0), // Суммы по picId
                        colorSums: {
                            red: 0,
                            green: 0,
                            blue: 0,
                            black: 0,
                            white: 0,
                            pale: 0,
                            vivid: 0
                        }
                    };
                }

                // Обновление сумм для цветов
                users[user].colorSums.red += parseFloat(item.red) || 0;
                users[user].colorSums.green += parseFloat(item.green) || 0;
                users[user].colorSums.blue += parseFloat(item.blue) || 0;
                users[user].colorSums.black += parseFloat(item.black) || 0;
                users[user].colorSums.white += parseFloat(item.white) || 0;
                users[user].colorSums.pale += parseFloat(item.pale) || 0;
                users[user].colorSums.vivid += parseFloat(item.vivid) || 0;

                // Обновление сумм для картин
                const picIdIndex = parseInt(picId);
                if (picIdIndex > 0 && picIdIndex <= 7) {
                    const colorSum = 
                        parseFloat(item.red) + 
                        parseFloat(item.green) + 
                        parseFloat(item.blue) + 
                        parseFloat(item.black) + 
                        parseFloat(item.white) + 
                        parseFloat(item.pale) + 
                        parseFloat(item.vivid) || 0;
                    
                    users[user].picSums[picIdIndex] += colorSum;
                }
            });

            // Заполнение таблицы
            const tbody = document.getElementById('data-body');
            for (const user in users) {
                const { picSums, colorSums } = users[user];
                const totalSum = Object.values(colorSums).reduce((a, b) => a + b, 0);
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user}</td>
                    <td>${picSums[1]}</td>
                    <td>${picSums[2]}</td>
                    <td>${picSums[3]}</td>
                    <td>${picSums[4]}</td>
                    <td>${picSums[5]}</td>
                    <td>${picSums[6]}</td>
                    <td>${picSums[7]}</td>
                    <td>${colorSums.red}</td>
                    <td>${colorSums.green}</td>
                    <td>${colorSums.blue}</td>
                    <td>${colorSums.black}</td>
                    <td>${colorSums.white}</td>
                    <td>${colorSums.pale}</td>
                    <td>${colorSums.vivid}</td>
                    <td>${totalSum}</td>
                `;
                tbody.appendChild(row);
            }
        })
        .catch(error => console.error('Ошибка загрузки данных:', error));

</script>
</body>
</html>
