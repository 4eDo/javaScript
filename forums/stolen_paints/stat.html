
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таблица с данными о картинах</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Данные о картинах</h1>
    <table id="paints-table">
        <thead>
            <tr>
                <th>Пользователь</th>
		<th colspan="7">Картины</th>
        	<th colspan="7">Цвета</th>
                <th>Итого</th>
            </tr>
            <tr>
                <th></th>
                <th>Алый дракон</th>
                <th>Зелёный леший</th>
                <th>Сапфировая акула</th>
                <th>Живая тень</th>
                <th>Белоснежный пегас</th>
                <th>Скучающий дементор</th>
                <th>Пьяная вейла</th>
                <th>red</th>
                <th>green</th>
                <th>blue</th>
                <th>black</th>
                <th>white</th>
                <th>pale</th>
                <th>vivid</th>
            </tr>
        </thead>
        <tbody>
            <!-- Данные будут добавлены здесь -->
        </tbody>
    </table>

    <script>
        const timestamp = new Date().getTime();
        const url = `https://4edo.github.io/javaScript/forums/stolen_paints/found_paints.json?timestamp=${timestamp}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                const userStats = {};

                data.forEach(item => {
                    const user = item.user;
                    const picId = item.picId;
                    const colors = ['red', 'green', 'blue', 'black', 'white', 'pale', 'vivid'];

                    if (!userStats[user]) {
                        userStats[user] = {
                            total: { red: 0, green: 0, blue: 0, black: 0, white: 0, pale: 0, vivid: 0 },
                            picTotals: {
                                '0': 0, '1': 0, '2': 0, '3': 0, '4': 0, '5': 0, '6': 0
                            }
                        };
                    }

                    // Суммируем цвета
                    colors.forEach(color => {
                        const value = parseFloat(item[color] || 0);
                        userStats[user].total[color] += value;
                        userStats[user].picTotals[picId] += value;
                    });
                });

                const tbody = document.getElementById('paints-table').getElementsByTagName('tbody')[0];

                for (const user in userStats) {
                    const stats = userStats[user];
                    const row = tbody.insertRow();

                    row.insertCell(0).innerText = user; // Пользователь

                    // Картины
                    const picCell = row.insertCell(1);
                    picCell.innerText = Object.values(stats.picTotals).join(', '); // Суммы по picId
                    
                    // Цвета
                    const colorCell = row.insertCell(2);
                    colorCell.innerText = Object.values(stats.total).join(', '); // Суммы по цветам

                    // Итого
                    const totalSum = Object.values(stats.total).reduce((acc, curr) => acc + curr, 0);
                    row.insertCell(3).innerText = totalSum.toFixed(2); // Итого
                }
            })
            .catch(error => {
                console.error('Ошибка при загрузке данных:', error);
            });
    </script>
</body>
</html>
