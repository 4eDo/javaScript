<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paints Data</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Данные по картинам</h1>
    <table>
        <thead>
            <tr>
                <th>Пользователь</th>
		<th colspan="7">Картины</th>
        	<th colspan="7">Цвета</th>
                <th>Итого</th>
            </tr>
            <tr>
                <th></th>
                <th>Алый дракон</th>
                <th>Зелёный леший</th>
                <th>Сапфировая акула</th>
                <th>Живая тень</th>
                <th>Белоснежный пегас</th>
                <th>Скучающий дементор</th>
                <th>Пьяная вейла</th>
                <th>red</th>
                <th>green</th>
                <th>blue</th>
                <th>black</th>
                <th>white</th>
                <th>pale</th>
                <th>vivid</th>
            </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
    </table>

    <script>
        // Функция для загрузки данных из файла JSON
        async function loadPaintData() {
	    	const timestamp = new Date().getTime();
            const response = await fetch('https://4edo.github.io/javaScript/forums/stolen_paints/found_paints.json?timestamp=${timestamp}');
            const data = await response.json();
            return data;
        }

        // Функция для формирования таблицы
        function buildTable(data) {
            const groupedData = {};

            data.forEach(item => {
                const user = item.user;
                const picId = item.picId;
                const colors = {
                    red: parseFloat(item.red) || 0,
                    green: parseFloat(item.green) || 0,
                    blue: parseFloat(item.blue) || 0,
                    black: parseFloat(item.black) || 0,
                    white: parseFloat(item.white) || 0,
                    pale: parseFloat(item.pale) || 0,
                    vivid: parseFloat(item.vivid) || 0,
                };

                if (!groupedData[user]) {
                    groupedData[user] = {
                        total: {
                            red: 0,
                            green: 0,
                            blue: 0,
                            black: 0,
                            white: 0,
                            pale: 0,
                            vivid: 0,
                        },
                        picSums: Array(7).fill(0) // 7 картин
                    };
                }

                // Добавление значений для picId
                groupedData[user].picSums[picId] += Object.values(colors).reduce((sum, value) => sum + value, 0);

                // Суммирование цветов для пользователя
                for (const [key, value] of Object.entries(colors)) {
                    groupedData[user].total[key] += value;
                }
            });

            const tableBody = document.getElementById('table-body');
            for (const user in groupedData) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user}</td>
                    ${groupedData[user].picSums.map(sum => `<td>${sum.toFixed(1)}</td>`).join('')}
                    ${Object.values(groupedData[user].total).map(total => `<td>${total.toFixed(1)}</td>`).join('')}
                `;
                tableBody.appendChild(row);
            }
        }

        // Основной код для выполнения загрузки и построения таблицы
        loadPaintData().then(buildTable).catch(error => console.error('Ошибка при загрузке данных:', error));
    </script>
</body>
</html>
