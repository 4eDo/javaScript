<!DOCTYPE html>
<html>
<head>
<title>Форма</title>
</head>
<body>

<p>User: <input type="text" id="uname" /></p>
<p>PicId: <input type="number" min="0" max="7" id="picId"/></p>
<p>Count: <input type="number" min="1" id="count" /></p>
<p>pigm: <input type="number" min="0" id="pigm"  step="0.5"/></p>
<p>selColor: <select id="color">
	<option value="none">none</option>
	<option value="red">red</option>
	<option value="green">green</option>
	<option value="blue">blue</option>
	<option value="black">black</option>
	<option value="white">white</option>
	<option value="pale">pale</option>
	<option value="vivid">vivid</option>
</select></p>
<p>Red: <input type="number"  id="red" step="0.5"/></p>
<p>Green: <input type="number"  id="green" step="0.5"/></p>
<p>Blue: <input type="number"  id="blue" step="0.5"/></p>
<p>Black: <input type="number"  id="black" step="0.5"/></p>
<p>White: <input type="number"  id="white" step="0.5"/></p>
<p>Pale: <input type="number"  id="pale" step="0.5"/></p>
<p>Vivid: <input type="number"  id="vivid" step="0.5"/></p>

<button id="getLinkBtn">Получить ссылку</button>
<button id="loadCodeBtn">Загрузить код</button>

<textarea id="outputText" readonly placeholder="Результат будет здесь..."></textarea>

<script>
  const getLinkBtn = document.getElementById('getLinkBtn');
  const loadCodeBtn = document.getElementById('loadCodeBtn');
  const outputText = document.getElementById('outputText');
  const fields = [
    'uname',
    'picId',
    'count',
    'pigm',
    'color',
    'red',
    'green',
    'blue',
    'black',
    'white',
    'pale',
    'vivid',
  ];

  // Функция для получения значений из формы или URL-параметров
  function getValues(source = 'form') {
    const values = {};
    fields.forEach(field => {
      const element = document.getElementById(field);
      const value = source === 'form' ? element.value : new URLSearchParams(window.location.search).get(field) || 0;
      values[field] = value;
    });
    return values;
  }

  // Функция для заполнения формы значениями
  function setValues(values) {
    fields.forEach(field => {
      document.getElementById(field).value = values[field];
    });
  }

  // Функция для обработки значений полей
  function processValues(values) {
    if (values.count > 1) {
      ['red', 'green', 'blue', 'black', 'white', 'pale', 'vivid'].forEach(field => {
        values[field] = parseFloat(values[field]) * values.count;
      });
    }

    if (!values.red && !values.green && !values.blue && !values.black && !values.white && !values.pale && !values.vivid) {
      if (values.color === "none") {
        const colors = ["red", "green", "blue", "black", "white", "pale", "vivid"];
        const randomColor = colors[Math.floor(Math.random() * colors.length)];
        values[randomColor] = values.pigm;
      } else {
        values[values.color] = values.pigm;
      }
    }
    return values;
  }

  // Функция для формирования JSON-объекта
  function createJson(values) {
    return `
    {
        "user": "${values.uname}",
        "picId": "${values.picId}",
        "red": "${values.red}",
        "green": "${values.green}",
        "blue": "${values.blue}",
        "white": "${values.white}",
        "black": "${values.black}",
        "pale": "${values.pale}",
        "vivid": "${values.vivid}"
      },`;
  }

  // Загрузка формы из URL-параметров при загрузке страницы
  window.addEventListener('load', () => {
    setValues(processValues(getValues('url')));
  });

  getLinkBtn.addEventListener('click', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const values = processValues(getValues('form'));

    fields.forEach(field => {
      if (values[field]) urlParams.set(field, values[field]);
    });

    const newUrl = `${window.location.origin}${window.location.pathname}?${urlParams.toString()}`;
    outputText.value = newUrl;
  });

  loadCodeBtn.addEventListener('click', () => {
    const values = processValues(getValues('url'));
    setValues(values);
    outputText.value = createJson(values);
  });
</script>
</body>
</html>
